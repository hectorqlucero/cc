{% extends "base.html" %}
{% block meta %}
<meta http-equiv="Refresh"  content="120">
{% endblock %}
{% block head %}
{% endblock %}
{% block content %}
{% csrf-field %}
<div id="calendar"></div>
<div id="dialog" title="Detalles">
</div>
{% endblock %}
{% block scripts %}
<script>
 $(document).ready(function() {
     var initialLocaleCode = 'es';

     $('#calendar').fullCalendar({
         defaultView: 'month',
         theme: true,
         height: "parent",
         contentHeight: "auto",
         aspectRatio: 2,
         header: {
             left: 'prev,next today',
             center: 'title',
             right: 'month,agendaWeek,agendaDay,listMonth'
         },
         locale: initialLocaleCode,
         buttonIcons: true, // show the prev/next text
         weekNumbers: true,
         showNonCurrentDates: false,
         navLinks: true, // can click day/week names to navigate views
         editable: true,
         eventLimit: true, // allow "more" link when too many events
         displayEventTime: true,
         timeFormat: 'h(:mm) t',
         events: {{events|safe}},
         color: 'deepskyblue',
         textColor: 'white',
         eventLimit: true,
         eventClick: function(calEvent, jsEvent) {
             var datos = 'Descripcion: ' + calEvent.description + '\nNivel: ' + calEvent.nivel + '\nDistancia: ' + calEvent.distancia + '\nVelocidad: ' + calEvent.velocidad + '\nPunto de reunión: ' + calEvent.donde + '\nLider: ' + calEvent.leader + '\nEmal: ' + calEvent.email + '\nConfirmados: ' + calEvent.confirmados + '\n\nOprimir Cancel para regresar al Calendario, OK para confirmar asistencia'
             var r = confirm(datos);
             if (! r) return false;
         },
         eventMouseover: function(calEvent, jsEvent) {
             var tooltip = '<div class="tooltipevent" style="z-index:100001;border:1px solid #F1D031;color:#444;background:#FFFFA3;box-shadow::0 2px 3px #999;position:absolute;padding:5px;text-align:left;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;"><p><strong>Descripcion:</strong></br> ' + calEvent.description + '</p><p><strong>Nivel:</strong></br> ' + calEvent.nivel + '<p><strong>Distancia:</strong></br> ' + calEvent.distancia + '<p><strong>Velocidad:</strong></br>' + calEvent.velocidad + '<p><strong>Punto de reunión:</strong></br>' + calEvent.donde + '</p><p><strong>Lider:</strong></br>' + calEvent.leader + '</p><p><strong>Email:</strong></br>' + calEvent.email + '</p><p><strong>Confirmados:</strong></br>' + calEvent.confirmados + '</p></div>';
             var $tooltip = $(tooltip).appendTo('body');

             $(this).mouseover(function(e) {
                 $tooltip.fadeIn('500');
                 $tooltip.fadeTo('10', 1.9);
             }).mousemove(function(e) {
                 var pLeft;
                 var pTop;
                 var offset = 10;
                 var CursorX = e.pageX;
                 var CursorY = e.pageY;
                 var WindowWidth = $(window).width();
                 var WindowHeight = $(window).height();
                 var toolTip = $('.tooltipevent');
                 var TTWidth = toolTip.width();
                 var TTHeight = toolTip.height();
                 if(CursorX-offset >= (WindowWidth/4)*3) {
                     pLeft = CursorX - TTWidth - offset;
                 } else {
                     pLeft = CursorX + offset;
                 }
                 if(CursorY-offset >= (WindowHeight/4)*3) {
                     pTop = CursorY - TTHeight - offset;
                 } else {
                     pTop = CursorY + offset;
                 }
                 $tooltip.css('top', pTop);
                 $tooltip.css('left', pLeft);
             });
         },

         eventMouseout: function(calEvent, jsEvent) {
             $(this).css('z-index', 8);
             $('.tooltipevent').remove();
         },
     });
 });
 $(".tooltipevent").css("overflow-y","scroll");
</script>
{% endblock %}

